<!DOCTYPE html>
<html lang="ru-ru">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='Предисловие Nuxt — &amp;ldquo;фреймворк над фреймворком Vue&amp;rdquo; или популярная конфигурация Vue-based приложений с использованием лучших практик разработки на Vue. Среди них: организация каталогов приложения; включение и преконфигурация самых популярных инструментов в виде Nuxt модулей; включение Vuex по-умолчанию в любую конфигурацию; готовый и преднастроенный SSR с hot-reloading&amp;rsquo;ом
Django — самый популярный веб-фреймворк на почти самом популярном языке программирования на сегодняшний день — Python. Сами разработчики позиционируют проект как &amp;ldquo;Веб-фреймворк для перфекционистов с дедлайнами&amp;rdquo;.'><title>Nuxt &#43; Django &#43; GraphQL на примере</title>

<link rel='canonical' href='https://ingvarlistard.github.io/p/nuxt-django-graphql/'>

<link rel="stylesheet" href="/scss/style.min.749341a908b08a9de4ebb5a55fd8f92be836a2d6953a0e8bdedbdb544bfa992b.css"><meta property='og:title' content='Nuxt &#43; Django &#43; GraphQL на примере'>
<meta property='og:description' content='Предисловие Nuxt — &amp;ldquo;фреймворк над фреймворком Vue&amp;rdquo; или популярная конфигурация Vue-based приложений с использованием лучших практик разработки на Vue. Среди них: организация каталогов приложения; включение и преконфигурация самых популярных инструментов в виде Nuxt модулей; включение Vuex по-умолчанию в любую конфигурацию; готовый и преднастроенный SSR с hot-reloading&amp;rsquo;ом
Django — самый популярный веб-фреймворк на почти самом популярном языке программирования на сегодняшний день — Python. Сами разработчики позиционируют проект как &amp;ldquo;Веб-фреймворк для перфекционистов с дедлайнами&amp;rdquo;.'>
<meta property='og:url' content='https://ingvarlistard.github.io/p/nuxt-django-graphql/'>
<meta property='og:site_name' content='Handy Code'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:published_time' content='2020-03-16T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2020-03-16T00:00:00&#43;00:00'/><meta property='og:image' content='https://ingvarlistard.github.io/p/nuxt-django-graphql/cmnlwmcwqu2drhdusjqe2nn6luq.jpeg' />
<meta name="twitter:title" content="Nuxt &#43; Django &#43; GraphQL на примере">
<meta name="twitter:description" content="Предисловие Nuxt — &amp;ldquo;фреймворк над фреймворком Vue&amp;rdquo; или популярная конфигурация Vue-based приложений с использованием лучших практик разработки на Vue. Среди них: организация каталогов приложения; включение и преконфигурация самых популярных инструментов в виде Nuxt модулей; включение Vuex по-умолчанию в любую конфигурацию; готовый и преднастроенный SSR с hot-reloading&amp;rsquo;ом
Django — самый популярный веб-фреймворк на почти самом популярном языке программирования на сегодняшний день — Python. Сами разработчики позиционируют проект как &amp;ldquo;Веб-фреймворк для перфекционистов с дедлайнами&amp;rdquo;."><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://ingvarlistard.github.io/p/nuxt-django-graphql/cmnlwmcwqu2drhdusjqe2nn6luq.jpeg' />
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Y4HM7JZBCS"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-Y4HM7JZBCS', { 'anonymize_ip': false });
}
</script>

    </head>
    <body class="
    article-page has-toc
">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex 
    
        extended
    
">
    
        <div id="article-toolbar">
            <a href="/" class="back-home">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



                <span>Назад</span>
            </a>
        </div>
    
<main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/p/nuxt-django-graphql/">
                <img src="/p/nuxt-django-graphql/cmnlwmcwqu2drhdusjqe2nn6luq_hudde38cee2deb85aef79833b7aa1c1180_25654_800x0_resize_q75_box.jpeg"
                        srcset="/p/nuxt-django-graphql/cmnlwmcwqu2drhdusjqe2nn6luq_hudde38cee2deb85aef79833b7aa1c1180_25654_800x0_resize_q75_box.jpeg 800w, /p/nuxt-django-graphql/cmnlwmcwqu2drhdusjqe2nn6luq_hudde38cee2deb85aef79833b7aa1c1180_25654_1600x0_resize_q75_box.jpeg 1600w"
                        width="800" 
                        height="450" 
                        loading="lazy"
                        alt="Featured image of post Nuxt &#43; Django &#43; GraphQL на примере" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/django/" style="background-color: #2a9d8f; color: #fff;">
                Django
            </a>
        
            <a href="/categories/python/" style="background-color: #2a9d8f; color: #fff;">
                Python
            </a>
        
    </header>
    

    <h2 class="article-title">
        <a href="/p/nuxt-django-graphql/">Nuxt &#43; Django &#43; GraphQL на примере</a>
    </h2>

    

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Mar 16, 2020</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    Время чтения: 20 мин.
                </time>
            </div>
        
    </footer>
    
</div>
</header>

    <section class="article-content">
    <h2 id="предисловие">Предисловие</h2>
<p><strong>Nuxt</strong> — &ldquo;фреймворк над фреймворком Vue&rdquo; или  популярная конфигурация Vue-based приложений с использованием лучших  практик разработки на Vue. Среди них: организация каталогов приложения;  включение и преконфигурация самых популярных инструментов в виде Nuxt  модулей; включение <a class="link" href="https://vuex.vuejs.org/ru/"  target="_blank" rel="noopener"
    >Vuex</a> по-умолчанию в любую конфигурацию; готовый и преднастроенный <a class="link" href="https://ssr.vuejs.org/ru/#%d1%87%d1%82%d0%be-%d1%82%d0%b0%d0%ba%d0%be%d0%b5-%d1%81%d0%b5%d1%80%d0%b2%d0%b5%d1%80%d0%bd%d1%8b%d0%b9-%d1%80%d0%b5%d0%bd%d0%b4%d0%b5%d1%80%d0%b8%d0%bd%d0%b3-ssr"  target="_blank" rel="noopener"
    >SSR</a> с <a class="link" href="https://vue-loader-v14.vuejs.org/ru/features/hot-reload.html"  target="_blank" rel="noopener"
    >hot-reloading&rsquo;ом</a></p>
<p><strong>Django</strong> — самый популярный веб-фреймворк на почти самом  популярном языке программирования на сегодняшний день — Python. Сами  разработчики позиционируют проект как &ldquo;Веб-фреймворк для перфекционистов с дедлайнами&rdquo;. Представляет из себя решение &ldquo;всё в одном&rdquo; и позволяет в кратчайшие сроки построить MVP вашего веб-приложения.</p>
<p><strong>GraphQL</strong> — язык запросов изначально созданный компанией  Facebook. В статье будет говориться о конкретных реализациях протокола  этого языка, а именно библиотек <strong>Apollo</strong> для фронтенда и <strong>graphene</strong> для бэкенда.</p>
<h2 id="о-чем-и-для-кого-эта-статья">О чем и для кого эта статья</h2>
<p>В этой статье вы сможете узнать как можно собрать dev-окружение современного <a class="link" href="https://ru.wikipedia.org/wiki/%d0%9e%d0%b4%d0%bd%d0%be%d1%81%d1%82%d1%80%d0%b0%d0%bd%d0%b8%d1%87%d0%bd%d0%be%d0%b5_%d0%bf%d1%80%d0%b8%d0%bb%d0%be%d0%b6%d0%b5%d0%bd%d0%b8%d0%b5"  target="_blank" rel="noopener"
    >SPA</a> приложения с server side рендерингом, на основе фреймворков Django и Nuxt, а также их сообщения посредством GraphQL API.</p>
<p>На примере простейшего приложения со списком задач, я попытался  рассказать об основных проблемах с которыми я столкнулся в процессе  построения приложения на выбранном стеке.</p>
<p>Описание старался делать как можно более понятным, в том числе и  новичкам в программировании (коим, буду честен, я считаю и себя), и  приводить как можно больше ссылок.</p>
<p>Исходя из того, что эту статью вы читаете на русском языке, я делаю  смелое предположение, что и остальные материалы по программированию вы  также предпочитаете читать на русском, поэтому все ссылки я старался  подбирать в соответствии с этим предположением насколько это возможно.</p>
<p>Искрене надеюсь, что статья поможет сэкономить хоть немного времени  тем энтузиастам, кто решит создать свое приложения на базе приведенных  выше технологий, а также дать быстрый старт всем интересующимся без  необходимости проводить часы и дни в поисках причин возникающих проблем, а затем и их решений на просторах интернета.</p>
<p>Построение приложения будет вестись поэтапно, чтобы на каждом этапе можно было удостовериться что всё работает правильно.</p>
<h2 id="перед-началом">Перед началом</h2>
<p>Убедитесь, что у вас уже установлен <a class="link" href="https://nodejs.org/ru/"  target="_blank" rel="noopener"
    >node.js</a> и интерпретатор <a class="link" href="https://www.python.org/downloads/"  target="_blank" rel="noopener"
    >python</a>. В примере используются версии: <strong>13.9</strong> и <strong>3.7</strong> соответственно.</p>
<p>В качестве менеджера виртуального окружения python в статье будет использоваться <a class="link" href="https://webdevblog.ru/pipenv-rukovodstvo-po-novomu-instrumentu-python/"  target="_blank" rel="noopener"
    >pipenv</a>.</p>
<p>Консольные команды в статье запускаются в оболочке bash. Если вы пользователь Windows, то вместо команд <code>cd</code>, <code>mv</code>, <code>mkdir</code> используйте аналоги, и благодаря кросс-платформенной природе python и  node, всё остальное должно работать вне зависимости от ОС.</p>
<p>В качестве базы данных для простоты будет использоваться Sqlite, которая не требует дополнительной конфигурации.</p>
<p>Версии всех пакетов вы всегда можете посмотреть в <a class="link" href="https://github.com/IngvarListard/nuxt-django-graphql-example"  target="_blank" rel="noopener"
    >репозитории</a> статьи. Ниже я приведу те, что мы будем устанавливать вручную.</p>
<p><strong>Python библиотеки</strong></p>
<table>
<thead>
<tr>
<th>Библиотека</th>
<th>Версия</th>
</tr>
</thead>
<tbody>
<tr>
<td><a class="link" href="https://docs.djangoproject.com/en/2.2/releases/2.2/"  target="_blank" rel="noopener"
    >django</a></td>
<td>2.2</td>
</tr>
<tr>
<td><a class="link" href="https://docs.graphene-python.org/projects/django/en/latest/"  target="_blank" rel="noopener"
    >graphene-django</a></td>
<td>2.8.2</td>
</tr>
<tr>
<td><a class="link" href="https://github.com/adamchainz/django-cors-headers"  target="_blank" rel="noopener"
    >django-cors-headers</a></td>
<td>3.2</td>
</tr>
</tbody>
</table>
<p><strong>Javascript библиотеки</strong></p>
<table>
<thead>
<tr>
<th>Библиотека</th>
<th>Версия</th>
</tr>
</thead>
<tbody>
<tr>
<td><a class="link" href="https://nuxtjs.org"  target="_blank" rel="noopener"
    >Nuxt</a></td>
<td>2.11</td>
</tr>
<tr>
<td><a class="link" href="https://github.com/nuxt-community/apollo-module"  target="_blank" rel="noopener"
    >nuxtjs/apollo</a></td>
<td>4.0.1</td>
</tr>
<tr>
<td><a class="link" href="https://v15.vuetifyjs.com/en/"  target="_blank" rel="noopener"
    >nuxtjs/vuetify</a></td>
<td>0.5.5</td>
</tr>
<tr>
<td><a class="link" href="https://github.com/microcipcip/cookie-universal/tree/master/packages/cookie-universal-nuxt"  target="_blank" rel="noopener"
    >cookie-universal-nuxt</a></td>
<td>2.1.2</td>
</tr>
<tr>
<td><a class="link" href="https://github.com/apollographql/graphql-tag"  target="_blank" rel="noopener"
    >graphql-tag</a></td>
<td>2.10</td>
</tr>
</tbody>
</table>
<h2 id="django">Django</h2>
<h3 id="создание-проекта-и-окружения">Создание проекта и окружения</h3>
<p>Для начала необходимо установить менеджер виртуального окружения. В примере я буду использовать pipenv. Для установки:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">pip install pipenv
</span></span></code></pre></div><p>В некоторых операционных системах для этого действия могут  потребоваться права суперпользователя. Также pipenv можно установить из  репозитория вашей операционной системы.</p>
<p>Создадим директорию с проектом и инициализируем в ней окружение <code>pipenv</code>. В моем случае проект будет располагаться по пути <code>~/Documents/projects/todo-list</code>. Создадим эту директорию и перейдем в неё.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">mkdir ~/Documents/projects/todo-list
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> ~/Documents/projects/todo-list
</span></span></code></pre></div><p>Создаем виртуальное окружение и одновременно устанавливаем <code>django</code> и <code>graphene_django</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">pipenv install <span class="nv">django</span><span class="o">==</span>2.2.10 graphene_django
</span></span></code></pre></div><p>Библиотека <code>graphene_django</code> позволяет описывать схему  GraphQL API на основе моделей Django ORM. Очень удобно, но как по мне,  со связыванием таблиц БД и фронтом напрямую нужно быть очень осторожным.</p>
<p>Для начала активируем виртуальное окружение pipenv. Далее в статье  будет предполагаться, что все комманды будут выполняться внутри  окружения.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">pipenv shell  <span class="c1"># активируем виртуальное окружение pipenv</span>
</span></span></code></pre></div><p>Создаем проект Django.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">django-admin createapp backend
</span></span></code></pre></div><h3 id="настройка">Настройка</h3>
<h4 id="перенос-managepy">Перенос manage.py</h4>
<p>Так как фронтенд и бэкенд нашего todo-листа будет находиться в одной  директории, было бы неплохо иметь все управляющие файлы в корневой  директории проекта. В Django управляющим файлом является <code>manage.py</code>, давайте вынесем его из директории <code>backend</code> на уровень повыше.</p>
<p>Для этого, из корневой директории проекта:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">mv backend/manage.py .
</span></span></code></pre></div><p>После перемещения нужно исправить путь к файлу настроек внутри файла <code>manage.py</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># manage.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">sys</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># укажите путь к файлу настроек вашего проекта</span>
</span></span><span class="line"><span class="cl">    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s2">&#34;DJANGO_SETTINGS_MODULE&#34;</span><span class="p">,</span> <span class="s2">&#34;backend.backend.settings&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span></code></pre></div><p>Также в файле <code>backend/backend/settings.py</code> приведем следующие переменные к виду:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">ROOT_URLCONF</span> <span class="o">=</span> <span class="s1">&#39;backend.backend.urls&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">WSGI_APPLICATION</span> <span class="o">=</span> <span class="s1">&#39;backend.backend.wsgi.application&#39;</span>
</span></span></code></pre></div><h4 id="добавление-graphene_django">Добавление graphene_django</h4>
<p>В файле <code>backend/backend/settings.py</code> в переменную <code>INSTALLED_APPS</code> добавляем установленный ранее <code>graphene_django</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># backend/backend/settings.py</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="o">...</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s1">&#39;graphene_django&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><h4 id="проверяем-работоспособность">Проверяем работоспособность</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">python manage.py runserver
</span></span></code></pre></div><p>По-умолчанию сервер запускается на порту <code>8000</code>. Переходим на http://localhost:8000/, он должен нас встречать следующей картиной:</p>
 

<details>
    <summary><strong>Django hello</strong></summary>
    <section>
        <figure 
	
		class="gallery-image" 
		style="
			flex-grow: 172; 
			flex-basis: 414px"
	>
	<a href="/p/nuxt-django-graphql/hhb-rytssx5jg9nspydgu6lwenc.png" data-size="597x346">
		<img src="/p/nuxt-django-graphql/hhb-rytssx5jg9nspydgu6lwenc.png"
			width="597"
			height="346"
			srcset="/p/nuxt-django-graphql/hhb-rytssx5jg9nspydgu6lwenc_hua2e903f190b514e479de90d1bfb1ac90_30631_480x0_resize_box_3.png 480w, /p/nuxt-django-graphql/hhb-rytssx5jg9nspydgu6lwenc_hua2e903f190b514e479de90d1bfb1ac90_30631_1024x0_resize_box_3.png 1024w"
			loading="lazy"
			alt="Django hello">
	</a>
	
	<figcaption>Django hello</figcaption>
	
</figure>
    </section>
</details>

<h4 id="настройка-graphene">Настройка graphene</h4>
<p>После изменений ниже <code>http://localhost:8000/</code> уже не будет встречать нас ракетой. В файле <code>backend/backend/urls.py</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># backend/backend/urls.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="kn">import</span> <span class="n">admin</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">path</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">graphene_django.views</span> <span class="kn">import</span> <span class="n">GraphQLView</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># graphiql - мини IDE для разработки graphql запросов</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;graphql/&#39;</span><span class="p">,</span> <span class="n">GraphQLView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">graphiql</span><span class="o">=</span><span class="n">settings</span><span class="o">.</span><span class="n">DEBUG</span><span class="p">))</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><p>Создадим пустую <a class="link" href="https://xsltdev.ru/react/graphql/schemas-and-types/"  target="_blank" rel="noopener"
    >схему</a>, например, в файле <code>backend/backend/api.py</code></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># backend/todo_list/api.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">graphene</span>
</span></span><span class="line"><span class="cl"><span class="n">schema</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">Schema</span><span class="p">()</span>
</span></span></code></pre></div><p>В файл настроек необходимо добавить переменную <code>GRAPHENE</code>, в которой мы укажем путь до нашей схемы:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># /backend/backend/settings.py</span>
</span></span><span class="line"><span class="cl"><span class="n">GRAPHENE</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;SCHEMA&#39;</span><span class="p">:</span> <span class="s1">&#39;backend.backend.api.schema&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Проверяем работоспособность. Запускаем сервер уже известной командой <code>runserver</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">python manage.py runserver
</span></span></code></pre></div><p>и переходим на http://localhost:8000/graphql/. Там нас должна встретить та самая мини &ldquo;IDE&rdquo; <a class="link" href="https://github.com/graphql/graphiql"  target="_blank" rel="noopener"
    >GrapiQL</a>:</p>
 

<details>
    <summary><strong>Graphiql IDE</strong></summary>
    <section>
        <figure 
	
		class="gallery-image" 
		style="
			flex-grow: 208; 
			flex-basis: 501px"
	>
	<a href="/p/nuxt-django-graphql/ptjbnvouc67igph8iswnrys656g.png" data-size="1051x503">
		<img src="/p/nuxt-django-graphql/ptjbnvouc67igph8iswnrys656g.png"
			width="1051"
			height="503"
			srcset="/p/nuxt-django-graphql/ptjbnvouc67igph8iswnrys656g_huc073217815f655a5917b6e9b1826fd87_90332_480x0_resize_box_3.png 480w, /p/nuxt-django-graphql/ptjbnvouc67igph8iswnrys656g_huc073217815f655a5917b6e9b1826fd87_90332_1024x0_resize_box_3.png 1024w"
			loading="lazy"
			alt="Graphiql ide">
	</a>
	
	<figcaption>Graphiql ide</figcaption>
	
</figure>
    </section>
</details>

<p>Ничего страшного в том, что нас встречает ошибка. Она появляется  из-за того, что наша схема пуста. Мы исправим это при реализации дальше.</p>
<h3 id="приложение-todo_list">Приложение todo_list</h3>
<h4 id="создание-приложения">Создание приложения</h4>
<p>Создадим приложение todo_list и модели к нему. Не забывайте, что все команды должны выполняться внутри окружения pipenv:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="nb">cd</span> backend
</span></span><span class="line"><span class="cl">django-admin startapp todo_list
</span></span></code></pre></div><p>Скрипт <code>django-admin</code> не знает где находится корень нашего приложения, поэтому нам нужно немного подправить файл <code>backend/todo_list/apps.py</code>, чтобы он выглядит следующим образом:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.apps</span> <span class="kn">import</span> <span class="n">AppConfig</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">TodoListConfig</span><span class="p">(</span><span class="n">AppConfig</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;backend.todo_list&#39;</span>
</span></span></code></pre></div><p>Добавим наше новое приложение в <code>INSTALLED_APPS</code>, что находится в файле <code>settings.py</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># backend/backend/settings.py</span>
</span></span><span class="line"><span class="cl"><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;backend.todo_list&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><p>Добавим модели <code>Todo</code> и <code>Category</code> в файл <code>backend/todo_list/models.py</code>:</p>
 

<details>
    <summary><strong>models.py</strong></summary>
    <section>
        <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># backend/todo_list/models.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Category</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">unique</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s1">&#39;Категория&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s1">&#39;Категории&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">get_due_date</span><span class="p">():</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34; На выполнение задачи по-умолчанию даётся один день &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Todo</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">text</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">TextField</span><span class="p">(</span><span class="n">blank</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">created_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">auto_now_add</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">due_date</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">DateField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="n">get_due_date</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">category</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="n">Category</span><span class="p">,</span> <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;todo_list&#39;</span><span class="p">,</span> <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">PROTECT</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">done</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">BooleanField</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">verbose_name</span> <span class="o">=</span> <span class="s1">&#39;Задача&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="s1">&#39;Задачи&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>
</span></span></code></pre></div>
    </section>
</details>

<p>Для того, чтобы наши модели превратились в таблицы в БД, нужно выполнить следующее:</p>
<p>Создать файлы <a class="link" href="https://djbook.ru/rel1.7/topics/migrations.html"  target="_blank" rel="noopener"
    >миграций</a>, в которых будет описываться наша текущая схема:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">python manage.py makemigrations
</span></span></code></pre></div><p>С примерно таким выводом:</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 568; 
			flex-basis: 1363px"
	>
	<a href="/p/nuxt-django-graphql/zadktt1beqf8wd6wt2t7ps3d1qy.png" data-size="676x119">
		<img src="/p/nuxt-django-graphql/zadktt1beqf8wd6wt2t7ps3d1qy.png"
			width="676"
			height="119"
			srcset="/p/nuxt-django-graphql/zadktt1beqf8wd6wt2t7ps3d1qy_hu0d254fd8c9d013c10d38dfcf2492c82e_89403_480x0_resize_box_3.png 480w, /p/nuxt-django-graphql/zadktt1beqf8wd6wt2t7ps3d1qy_hu0d254fd8c9d013c10d38dfcf2492c82e_89403_1024x0_resize_box_3.png 1024w"
			loading="lazy"
			alt="Вывод">
	</a>
	
	<figcaption>Вывод</figcaption>
	
</figure></p>
<p>Применить эти миграции командой <code>migrate</code>. Т.к. это первый запуск скрипта <code>migrate</code>, у нас также будут применяться миграции приложений Django:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">python manage.py migrate
</span></span></code></pre></div> 

<details>
    <summary><strong>Вывод консоли</strong></summary>
    <section>
        <figure 
	
		class="gallery-image" 
		style="
			flex-grow: 159; 
			flex-basis: 382px"
	>
	<a href="/p/nuxt-django-graphql/sscryoufym2z282jrfldthrscjw.png" data-size="845x530">
		<img src="/p/nuxt-django-graphql/sscryoufym2z282jrfldthrscjw.png"
			width="845"
			height="530"
			srcset="/p/nuxt-django-graphql/sscryoufym2z282jrfldthrscjw_hud494317920ab598d554deae3b76404d4_503726_480x0_resize_box_3.png 480w, /p/nuxt-django-graphql/sscryoufym2z282jrfldthrscjw_hud494317920ab598d554deae3b76404d4_503726_1024x0_resize_box_3.png 1024w"
			loading="lazy"
			alt="Вывод консоли">
	</a>
	
	<figcaption>Вывод консоли</figcaption>
	
</figure>
    </section>
</details>

<h4 id="создание-graphql-api">Создание GraphQL API</h4>
<p>Опишем <a class="link" href="https://xsltdev.ru/react/graphql/schemas-and-types/"  target="_blank" rel="noopener"
    >типы</a>, <a class="link" href="https://xsltdev.ru/react/graphql/queries-and-mutations/"  target="_blank" rel="noopener"
    >создадим запросы и мутации</a> для наших новых моделей. Для этого в директории приложения <code>todo_list</code> создадим файл <code>schema.py</code>, со следующим содержимым:</p>
 

<details>
    <summary><strong>schema.py</strong></summary>
    <section>
        <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># backend/todo_list/schema.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">graphene</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">graphene_django</span> <span class="kn">import</span> <span class="n">DjangoObjectType</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">backend.todo_list.models</span> <span class="kn">import</span> <span class="n">Todo</span><span class="p">,</span> <span class="n">Category</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># С помощью graphene_django привязываем типы к моделям,</span>
</span></span><span class="line"><span class="cl"><span class="c1"># что позволит ходить по всей вложенности базы данных как угодно,</span>
</span></span><span class="line"><span class="cl"><span class="c1"># прямо из интерфейса GraphiQL.</span>
</span></span><span class="line"><span class="cl"><span class="c1"># Однако будьте осторожны, связывание таблиц практически напрямую</span>
</span></span><span class="line"><span class="cl"><span class="c1"># с фронтом может быть чревато при росте проекта. Думаю такой способ</span>
</span></span><span class="line"><span class="cl"><span class="c1"># подходит преимущественно для небольших CRUD приложений.</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CategoryNode</span><span class="p">(</span><span class="n">DjangoObjectType</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">Category</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">TodoNode</span><span class="p">(</span><span class="n">DjangoObjectType</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">model</span> <span class="o">=</span> <span class="n">Todo</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Query</span><span class="p">(</span><span class="n">graphene</span><span class="o">.</span><span class="n">ObjectType</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34; Описываем запросы и возвращаемые типы данных &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">todo_list</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">TodoNode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">categories</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">List</span><span class="p">(</span><span class="n">CategoryNode</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">resolve_todo_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Todo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span><span class="o">.</span><span class="n">order_by</span><span class="p">(</span><span class="s1">&#39;-id&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">resolve_categories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Mutation</span><span class="p">(</span><span class="n">graphene</span><span class="o">.</span><span class="n">ObjectType</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34; В мутации описываем типы запросов (простите за каламбур),
</span></span></span><span class="line"><span class="cl"><span class="s2">    типы возвращаемых данных и типы принимаемых переменных
</span></span></span><span class="line"><span class="cl"><span class="s2">    &#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">add_todo</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">TodoNode</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                              <span class="n">title</span><span class="o">=</span><span class="n">graphene</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                              <span class="n">text</span><span class="o">=</span><span class="n">graphene</span><span class="o">.</span><span class="n">String</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">                              <span class="n">due_date</span><span class="o">=</span><span class="n">graphene</span><span class="o">.</span><span class="n">Date</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                              <span class="n">category</span><span class="o">=</span><span class="n">graphene</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">remove_todo</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">graphene</span><span class="o">.</span><span class="n">Boolean</span><span class="p">,</span> <span class="n">todo_id</span><span class="o">=</span><span class="n">graphene</span><span class="o">.</span><span class="n">ID</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">    <span class="n">toggle_todo</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">Field</span><span class="p">(</span><span class="n">TodoNode</span><span class="p">,</span> <span class="n">todo_id</span><span class="o">=</span><span class="n">graphene</span><span class="o">.</span><span class="n">ID</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">resolve_add_todo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">category</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_or_create</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;category&#39;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">Todo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">category</span><span class="o">=</span><span class="n">category</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">resolve_remove_todo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">todo_id</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">Todo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">todo_id</span><span class="p">)</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="n">Todo</span><span class="o">.</span><span class="n">DoesNotExist</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">resolve_toggle_todo</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">todo_id</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">todo</span> <span class="o">=</span> <span class="n">Todo</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">todo_id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">todo</span><span class="o">.</span><span class="n">done</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">todo</span><span class="o">.</span><span class="n">done</span>
</span></span><span class="line"><span class="cl">        <span class="n">todo</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">todo</span>
</span></span></code></pre></div>
    </section>
</details>

<p>После создания классов мутации и запроса, их нужно добавить в нашу схему. Как вы, возможно, помните схему мы описывали в файле <code>api.py</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># backend/backend/api.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">graphene</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">backend.todo_list.schema</span> <span class="kn">import</span> <span class="n">Query</span><span class="p">,</span> <span class="n">Mutation</span>
</span></span><span class="line"><span class="cl"><span class="n">schema</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">Schema</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">Query</span><span class="p">,</span> <span class="n">mutation</span><span class="o">=</span><span class="n">Mutation</span><span class="p">)</span>
</span></span></code></pre></div><p>Если хотите лучше понять происходящее, можете прочитать <a class="link" href="https://habr.com/ru/post/461939/"  target="_blank" rel="noopener"
    >эту</a> статью на Хабре, или обратиться к документации <a class="link" href="https://docs.graphene-python.org/en/latest/types/"  target="_blank" rel="noopener"
    >Graphene</a> (англ.).</p>
<h4 id="проверка-api">Проверка API</h4>
<p>ID записей в примерах ниже могут различаться с ID ваших записей.</p>
<p>Запускаем сервер привычной командой <code>runserver</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">python manage.py runserver
</span></span></code></pre></div><p>Идем по пути http://localhost:8000/graphql/. Там нас должен встречать уже знакомый интерфейс <code>graphiql</code>. И как вы, возможно, заметили ошибка пропала.</p>
<p>Давайте проверим получившиеся запросы и мутации.</p>
 

<details>
    <summary><strong>addTodo</strong></summary>
    <section>
        <p><strong>Мутация</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-graphql" data-lang="graphql"><span class="line"><span class="cl"><span class="w">  </span><span class="kd">mutation</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nv">$title</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">!</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nv">$text</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nv">$dueDate</span><span class="p">:</span><span class="w"> </span><span class="nc">Date</span><span class="p">!</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nv">$category</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">!</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nc">addTodo</span><span class="p">(</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="py">title</span><span class="p">:</span><span class="w"> </span><span class="nv">$title</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nc">text</span><span class="p">:</span><span class="w"> </span><span class="nv">$text</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nc">dueDate</span><span class="p">:</span><span class="w"> </span><span class="nv">$dueDate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nc">category</span><span class="p">:</span><span class="w"> </span><span class="nv">$category</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nc">todo</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="py">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="py">title</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="py">text</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="py">done</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="py">createdDate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="py">dueDate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="py">category</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="py">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="py">name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><strong>Переменные</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-graphql" data-lang="graphql"><span class="line"><span class="cl"><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="s">&#34;title&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;First Todo&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="s">&#34;text&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;Just do it!&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="s">&#34;dueDate&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;2020-10-17&#34;</span><span class="p">,</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="s">&#34;category&#34;</span><span class="p">:</span><span class="w"> </span><span class="s">&#34;Работа&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><strong>Результат</strong></p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 184; 
			flex-basis: 443px"
	>
	<a href="/p/nuxt-django-graphql/ygwilohcsxhxvwn0x65lk661nt0.png" data-size="886x480">
		<img src="/p/nuxt-django-graphql/ygwilohcsxhxvwn0x65lk661nt0.png"
			width="886"
			height="480"
			srcset="/p/nuxt-django-graphql/ygwilohcsxhxvwn0x65lk661nt0_hu2612775fb225aa202d79f48c6e21f280_63114_480x0_resize_box_3.png 480w, /p/nuxt-django-graphql/ygwilohcsxhxvwn0x65lk661nt0_hu2612775fb225aa202d79f48c6e21f280_63114_1024x0_resize_box_3.png 1024w"
			loading="lazy"
			alt="Результат">
	</a>
	
	<figcaption>Результат</figcaption>
	
</figure></p>

    </section>
</details>

<p>В результате этой мутации у нас создалось две записи:</p>
<ul>
<li><code>Todo</code> т.к. собственно мутация для этого и написана;</li>
<li><code>Category</code>, т.к. в базе не оказалось категорий с названием &ldquo;Работа&rdquo;, а метод <code>get_or_create</code> говорит за себя сам.</li>
</ul>
 

<details>
    <summary><strong>todoList и categories</strong></summary>
    <section>
        <p><strong>Запрос</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-graphql" data-lang="graphql"><span class="line"><span class="cl"><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="py">todoList</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="py">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="py">title</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="py">text</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="py">createdDate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="py">dueDate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="py">category</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="py">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="py">name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="py">categories</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="py">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="py">name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><strong>Реузльтат</strong></p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 153; 
			flex-basis: 367px"
	>
	<a href="/p/nuxt-django-graphql/vua6horn_mwn6fvz2souvalge7e.png" data-size="650x424">
		<img src="/p/nuxt-django-graphql/vua6horn_mwn6fvz2souvalge7e.png"
			width="650"
			height="424"
			srcset="/p/nuxt-django-graphql/vua6horn_mwn6fvz2souvalge7e_hu65d776d28b3e164e071500bb98538ebb_43115_480x0_resize_box_3.png 480w, /p/nuxt-django-graphql/vua6horn_mwn6fvz2souvalge7e_hu65d776d28b3e164e071500bb98538ebb_43115_1024x0_resize_box_3.png 1024w"
			loading="lazy"
			alt="Результат">
	</a>
	
	<figcaption>Результат</figcaption>
	
</figure></p>

    </section>
</details>

 

<details>
    <summary><strong>toggleTodo</strong></summary>
    <section>
        <p><strong>Мутация</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-graphql" data-lang="graphql"><span class="line"><span class="cl"><span class="kd">mutation</span><span class="w"> </span><span class="p">(</span><span class="nv">$todoId</span><span class="p">:</span><span class="w"> </span><span class="nc">ID</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nc">toggleTodo</span><span class="p">(</span><span class="py">todoId</span><span class="p">:</span><span class="w"> </span><span class="nv">$todoId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nc">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="py">title</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="py">text</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="py">createdDate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="py">dueDate</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="py">category</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="py">id</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="py">name</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="py">done</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><strong>Переменные</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-graphql" data-lang="graphql"><span class="line"><span class="cl"><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="s">&#34;todoId&#34;</span><span class="p">:</span><span class="w"> </span><span class="sc">&#34;1&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p><strong>Результат</strong>:</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 183; 
			flex-basis: 441px"
	>
	<a href="/p/nuxt-django-graphql/oangcw2rkfy2clb-sgjfgbrghzw.png" data-size="888x483">
		<img src="/p/nuxt-django-graphql/oangcw2rkfy2clb-sgjfgbrghzw.png"
			width="888"
			height="483"
			srcset="/p/nuxt-django-graphql/oangcw2rkfy2clb-sgjfgbrghzw_hu7464e95f854a44b923b5c5021eae6669_51472_480x0_resize_box_3.png 480w, /p/nuxt-django-graphql/oangcw2rkfy2clb-sgjfgbrghzw_hu7464e95f854a44b923b5c5021eae6669_51472_1024x0_resize_box_3.png 1024w"
			loading="lazy"
			alt="Результат">
	</a>
	
	<figcaption>Результат</figcaption>
	
</figure></p>

    </section>
</details>

 

<details>
    <summary><strong>removeTodo</strong></summary>
    <section>
        <p><strong>Мутация</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-graphql" data-lang="graphql"><span class="line"><span class="cl"><span class="kd">mutation</span><span class="w"> </span><span class="p">(</span><span class="nv">$todoId</span><span class="p">:</span><span class="w"> </span><span class="nc">ID</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nc">removeTodo</span><span class="p">(</span><span class="py">todoId</span><span class="p">:</span><span class="w"> </span><span class="nv">$todoId</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span><span class="w">
</span></span></span></code></pre></div><p>Переменные можно оставить из предыдущей мутации.</p>
<p><strong>Результат</strong></p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 184; 
			flex-basis: 443px"
	>
	<a href="/p/nuxt-django-graphql/xovn268dblwy2d4gp97ahgnve6s.png" data-size="886x480">
		<img src="/p/nuxt-django-graphql/xovn268dblwy2d4gp97ahgnve6s.png"
			width="886"
			height="480"
			srcset="/p/nuxt-django-graphql/xovn268dblwy2d4gp97ahgnve6s_hu5f4e6d3d1bb47870f8b7efe3a9bfba45_24307_480x0_resize_box_3.png 480w, /p/nuxt-django-graphql/xovn268dblwy2d4gp97ahgnve6s_hu5f4e6d3d1bb47870f8b7efe3a9bfba45_24307_1024x0_resize_box_3.png 1024w"
			loading="lazy"
			alt="Результат">
	</a>
	
	<figcaption>Результат</figcaption>
	
</figure></p>

    </section>
</details>

<h2 id="nuxt">Nuxt</h2>
<h3 id="создание-nuxt-приложения">Создание Nuxt приложения</h3>
<p>Откройте консоль внутри корневой директории проекта и запустите скрипт установки <code>Nuxt</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">npx create-nuxt-app frontend
</span></span></code></pre></div><p>Запустится очень простой и понятный скрипт установки, который  предложит указать описание проекта и предоставит на выбор для установки  несколько библиотек. Можете выбрать, что захотите, но из рекомендуемых  пунктов я бы посоветовал выбрать &ldquo;Custom UI Framework: vuetify&rdquo;, т.к. в  примере используется именно он, и &ldquo;Rendering mode: Universal&rdquo;, т.к. в  статье рассматривается пример именно с SSR.</p>
<p>Пример моей конфигурации:</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 333; 
			flex-basis: 799px"
	>
	<a href="/p/nuxt-django-graphql/svcmav9eve7fwvxkvks75i7b3-y.png" data-size="976x293">
		<img src="/p/nuxt-django-graphql/svcmav9eve7fwvxkvks75i7b3-y.png"
			width="976"
			height="293"
			srcset="/p/nuxt-django-graphql/svcmav9eve7fwvxkvks75i7b3-y_hu8356fdecbcef694ab48121358e16e4f8_104364_480x0_resize_box_3.png 480w, /p/nuxt-django-graphql/svcmav9eve7fwvxkvks75i7b3-y_hu8356fdecbcef694ab48121358e16e4f8_104364_1024x0_resize_box_3.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>На установку зависимостей может потребоваться некоторое время. После  завершения работы скрипта вам предложат проверить его работоспособность. Давайте сделаем это:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="nb">cd</span> frontend
</span></span><span class="line"><span class="cl">npm run dev
</span></span></code></pre></div><p>и перейдем на http://localhost:3000. Там нас должна ждать страница приветствия Nuxt + Vuetify:</p>
 

<details>
    <summary><strong>Nuxt + Vuetify</strong></summary>
    <section>
        <figure 
	
		class="gallery-image" 
		style="
			flex-grow: 152; 
			flex-basis: 365px"
	>
	<a href="/p/nuxt-django-graphql/oimeo_qzmt-juuzhixs20put1cy.png" data-size="981x645">
		<img src="/p/nuxt-django-graphql/oimeo_qzmt-juuzhixs20put1cy.png"
			width="981"
			height="645"
			srcset="/p/nuxt-django-graphql/oimeo_qzmt-juuzhixs20put1cy_hu296e51479efad2c257c15cae13b74939_68530_480x0_resize_box_3.png 480w, /p/nuxt-django-graphql/oimeo_qzmt-juuzhixs20put1cy_hu296e51479efad2c257c15cae13b74939_68530_1024x0_resize_box_3.png 1024w"
			loading="lazy"
			alt="Nuxt &#43; Vuetify">
	</a>
	
	<figcaption>Nuxt + Vuetify</figcaption>
	
</figure>
    </section>
</details>

<h3 id="перенос-конфигурационных-файлов">Перенос конфигурационных файлов</h3>
<p>Как я говорил ранее, фронтенд и бэкенд будут находиться у нас в одной директории, поэтому было бы неплохо перенести конфигурационные файлы и  зависимости на уровень повыше. Для этого из корневой папки проекта  выполните:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl"><span class="nb">cd</span> frontend
</span></span><span class="line"><span class="cl">mv node_modules ..
</span></span><span class="line"><span class="cl">mv nuxt.config.js ..
</span></span><span class="line"><span class="cl">mv .gitignore ..
</span></span><span class="line"><span class="cl">mv package-lock.json ..
</span></span><span class="line"><span class="cl">mv package.json ..
</span></span><span class="line"><span class="cl">mv .prettierrc ..
</span></span><span class="line"><span class="cl">mv .eslintrc.js ..
</span></span><span class="line"><span class="cl">mv .editorconfig ..
</span></span><span class="line"><span class="cl">rm -rf .git
</span></span></code></pre></div><p>Затем в файле <code>nuxt.config.js</code> указываем корневую директорию приложения:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// nuxt.config.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="p">...,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">rootDir</span><span class="o">:</span> <span class="s1">&#39;frontend&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>После этого желательно еще раз убедиться в работоспособности проекта, выполнив запуск dev-сервера уже из корневой директории:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">npm run dev
</span></span></code></pre></div><h3 id="верстка-функционального-макета">Верстка функционального макета</h3>
<p>Любой компонент с префиксом <code>v-</code> это компонент UI-toolkit&rsquo;a Vuetify. У этой библиотеки отличная и подробная <a class="link" href="https://v15.vuetifyjs.com/ru/getting-started/quick-start"  target="_blank" rel="noopener"
    >документация</a>.</p>
<p>Если вы хотите подробнее узнать, что делает тот или иной компонент, смело вбивайте в гугл <code>v-component-name</code>. Только не забывайте, что в примере используется версия vuetify 1.5.</p>
<p>Приводим файл <code>frontend/layouts/default.vue</code> к виду:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">v-app</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">v-content</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">v-container</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">nuxt</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="err">/v-container&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/v-content&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="err">/v-app&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span></code></pre></div><p>Создадим компонент нового <code>Todo</code> по пути <code>frontend/components/NewTodoForm.vue</code>:</p>
 

<details>
    <summary><strong>NewTodoForm.vue</strong></summary>
    <section>
        <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="line"><span class="cl"><span class="c">&lt;!--</span> <span class="nx">frontend</span><span class="o">/</span><span class="nx">components</span><span class="o">/</span><span class="nx">NewTodoForm</span><span class="p">.</span><span class="nx">vue</span> <span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">v-form</span> <span class="na">ref</span><span class="o">=</span><span class="s">&#34;form&#34;</span> <span class="nt">v-model</span><span class="s">=&#34;valid&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">v-card</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">v-card-text</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pt-0 mt-0&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">v-layout</span> <span class="na">row</span> <span class="na">wrap</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">v-flex</span> <span class="na">xs8</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!--</span> <span class="nx">Поле</span> <span class="nx">ввода</span> <span class="nx">имени</span> <span class="nx">задачи</span> <span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">v-text-field</span>
</span></span><span class="line"><span class="cl">              <span class="nt">v-model</span><span class="s">=&#34;newTodo.title&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">              :rules=&#34;[nonEmptyField]&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">              label=&#34;Задача&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">              prepend-icon=&#34;check_circle_outline&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">            /&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">          &lt;/v-flex&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">          &lt;v-flex xs4&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">            &lt;!-- Поле выбора даты выполнения задачи --&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">            &lt;v-menu
</span></span></span><span class="line"><span class="cl"><span class="s">              ref=&#34;menu&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">              v-model=&#34;menu&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">              :close-on-content-click=&#34;false&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">              :nudge-right=&#34;40&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">              :return-value.sync=&#34;newTodo.dueDate&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">              lazy
</span></span></span><span class="line"><span class="cl"><span class="s">              transition=&#34;scale-transition&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">              offset-y
</span></span></span><span class="line"><span class="cl"><span class="s">              full-width
</span></span></span><span class="line"><span class="cl"><span class="s">              min-width=&#34;290px&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">            &gt;
</span></span></span><span class="line"><span class="cl"><span class="s">              &lt;template v-slot:activator=&#34;{ on }&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">                &lt;v-text-field
</span></span></span><span class="line"><span class="cl"><span class="s">                  v-model=&#34;newTodo.dueDate&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">                  :rules=&#34;[nonEmptyField]&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">                  v-on=&#34;on&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">                  label=&#34;Дата выполнения&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">                  prepend-icon=&#34;event&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">                  readonly
</span></span></span><span class="line"><span class="cl"><span class="s">                /&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">              &lt;/template&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">              &lt;v-date-picker
</span></span></span><span class="line"><span class="cl"><span class="s">                v-model=&#34;newTodo.dueDate&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">                no-title
</span></span></span><span class="line"><span class="cl"><span class="s">                scrollable
</span></span></span><span class="line"><span class="cl"><span class="s">                locale=&#34;ru-ru&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">                first-day-of-week=&#34;1&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">              &gt;
</span></span></span><span class="line"><span class="cl"><span class="s">                &lt;v-spacer /&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">                &lt;v-btn @click=&#34;menu = false&#34; flat color=&#34;primary&#34;</span><span class="p">&gt;</span><span class="na">Отмена</span><span class="err">&lt;/</span><span class="nt">v-btn</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="p">&lt;</span><span class="nt">v-btn</span>
</span></span><span class="line"><span class="cl">                  <span class="nt">@click</span><span class="s">=&#34;$refs.menu.save(newTodo.dueDate)&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="na">flat</span>
</span></span><span class="line"><span class="cl">                  <span class="na">color</span><span class="o">=</span><span class="s">&#34;primary&#34;</span>
</span></span><span class="line"><span class="cl">                  <span class="p">&gt;</span><span class="nx">Выбрать</span><span class="o">&lt;</span><span class="err">/v-btn</span>
</span></span><span class="line"><span class="cl">                <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">              <span class="o">&lt;</span><span class="err">/v-date-picker&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="o">&lt;</span><span class="err">/v-menu&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="o">&lt;</span><span class="err">/v-flex&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">v-flex</span> <span class="na">xs12</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">v-textarea</span>
</span></span><span class="line"><span class="cl">              <span class="na">v</span><span class="nt">-model</span><span class="err">=&#34;</span><span class="na">newTodo.text</span><span class="err">&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="nt">:rules</span><span class="s">=&#34;[nonEmptyField]&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="na">label</span><span class="o">=</span><span class="s">&#34;Описание&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="na">prepend</span><span class="nt">-icon</span><span class="err">=&#34;</span><span class="na">description</span><span class="err">&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="na">hide</span><span class="nt">-details</span>
</span></span><span class="line"><span class="cl">              <span class="na">rows</span><span class="o">=</span><span class="s">&#34;1&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="na">class</span><span class="o">=</span><span class="s">&#34;py-0 my-0&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="o">&lt;</span><span class="err">/v-flex&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="err">/v-layout&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="err">/v-card-text&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">v-card-actions</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!--</span> <span class="nx">Селектор</span> <span class="nx">категорий</span><span class="p">.</span> <span class="nx">Позволяет</span> <span class="nx">добавлять</span> <span class="nx">несуществующие</span> <span class="nx">позиции</span> <span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">v-combobox</span>
</span></span><span class="line"><span class="cl">          <span class="na">v</span><span class="nt">-model</span><span class="err">=&#34;</span><span class="na">newTodo.category</span><span class="err">&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">:rules</span><span class="s">=&#34;[nonEmptyField]&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="nt">:items</span><span class="s">=&#34;categories&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="na">hide</span><span class="nt">-details</span>
</span></span><span class="line"><span class="cl">          <span class="na">label</span><span class="o">=</span><span class="s">&#34;Категория&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="na">class</span><span class="o">=</span><span class="s">&#34;my-0 mx-2 mb-2 pt-0&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="na">prepend</span><span class="nt">-icon</span><span class="err">=&#34;</span><span class="na">category</span><span class="err">&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">v-spacer</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">v-btn</span> <span class="nt">:disabled</span><span class="s">=&#34;!valid&#34;</span> <span class="nt">@click</span><span class="s">=&#34;add&#34;</span> <span class="na">color</span><span class="o">=</span><span class="s">&#34;blue lighten-1&#34;</span> <span class="na">flat</span>
</span></span><span class="line"><span class="cl">          <span class="p">&gt;</span><span class="nx">Добавить</span><span class="o">&lt;</span><span class="err">/v-btn</span>
</span></span><span class="line"><span class="cl">        <span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="err">/v-card-actions&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/v-card&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="err">/v-form&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;NewTodoForm&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">newTodo</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">categories</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;Дом&#39;</span><span class="p">,</span> <span class="s1">&#39;Работа&#39;</span><span class="p">,</span> <span class="s1">&#39;Семья&#39;</span><span class="p">,</span> <span class="s1">&#39;Учеба&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nx">valid</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">menu</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">nonEmptyField</span><span class="o">:</span> <span class="nx">text</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">text</span> <span class="o">?</span> <span class="o">!!</span><span class="nx">text</span><span class="p">.</span><span class="nx">length</span> <span class="o">:</span> <span class="s1">&#39;Поле не должно быть пустым&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">created</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">clear</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">add</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">$emit</span><span class="p">(</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">newTodo</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">clear</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">$refs</span><span class="p">.</span><span class="nx">form</span><span class="p">.</span><span class="nx">reset</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">clear</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">newTodo</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">text</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">dueDate</span><span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">category</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span></code></pre></div>
    </section>
</details>

<p>Далее компонент существующего <code>Todo</code>, там же:</p>
 

<details>
    <summary><strong>TodoItem.vue</strong></summary>
    <section>
        <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="line"><span class="cl"><span class="c">&lt;!--</span> <span class="nx">frontend</span><span class="o">/</span><span class="nx">components</span><span class="o">/</span><span class="nx">TodoItem</span><span class="p">.</span><span class="nx">vue</span> <span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">v-card</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">v-card-title</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pb-1&#34;</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;overflow-wrap: break-word;&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">b</span><span class="p">&gt;{{</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">title</span> <span class="p">}}&lt;/</span><span class="nt">b</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">v-spacer</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">v-btn</span>
</span></span><span class="line"><span class="cl">        <span class="err">@</span><span class="na">click</span><span class="o">=</span><span class="s">&#34;$emit(&#39;delete&#39;, todo.id)&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">flat</span>
</span></span><span class="line"><span class="cl">        <span class="na">small</span>
</span></span><span class="line"><span class="cl">        <span class="na">icon</span>
</span></span><span class="line"><span class="cl">        <span class="na">style</span><span class="o">=</span><span class="s">&#34;position: absolute; right: 0; top: 0&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">v-icon</span> <span class="nt">:disabled</span><span class="s">=&#34;$nuxt.isServer&#34;</span> <span class="na">small</span><span class="p">&gt;</span><span class="nx">close</span><span class="o">&lt;</span><span class="err">/v-icon&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="err">/v-btn&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/v-card-title&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">v-card-text</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;py-1&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">v-layout</span> <span class="na">row</span> <span class="na">justyfy</span><span class="nt">-center</span> <span class="na">align</span><span class="nt">-center</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">v-flex</span> <span class="na">xs11</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;overflow-wrap: break-word;&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="p">{{</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">text</span> <span class="p">}}</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="err">/v-flex&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">v-flex</span> <span class="na">xs1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;text-align: right;&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">v-checkbox</span>
</span></span><span class="line"><span class="cl">              <span class="nt">v-model</span><span class="s">=&#34;todo.done&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">              hide-details
</span></span></span><span class="line"><span class="cl"><span class="s">              class=&#34;pa-0 ma-0&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">              style=&#34;display: inline-block;&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">              color=&#34;green lighten-1&#34;
</span></span></span><span class="line"><span class="cl"><span class="s">            /&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">          &lt;/div&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">        &lt;/v-flex&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">      &lt;/v-layout&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">    &lt;/v-card-text&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">    &lt;v-card-actions&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">      &lt;span class=&#34;grey--text&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">        Выполнить до &lt;v-icon small&gt;event&lt;/v-icon&gt; {{ todo.dueDate }} | Создано
</span></span></span><span class="line"><span class="cl"><span class="s">        &lt;v-icon small&gt;calendar_today&lt;/v-icon&gt; {{ todo.createdDate }}
</span></span></span><span class="line"><span class="cl"><span class="s">      &lt;/span&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">      &lt;v-spacer /&gt;
</span></span></span><span class="line"><span class="cl"><span class="s">      &lt;span class=&#34;grey--text&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">v-icon</span> <span class="na">small</span><span class="p">&gt;</span><span class="nx">category</span><span class="o">&lt;</span><span class="err">/v-icon&gt;Категория: {{ todo.category }}</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/v-card-actions&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="err">/v-card&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;TodoItem&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">todo</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">type</span><span class="o">:</span> <span class="nb">Object</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="k">default</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">({})</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span></code></pre></div>
    </section>
</details>

<p>И наконец вставим новые компоненты в <code>index.vue</code>, и добавим в него немного рыбы:</p>
 

<details>
    <summary><strong>index.vue</strong></summary>
    <section>
        <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="line"><span class="cl"><span class="c">&lt;!--</span> <span class="nx">frontend</span><span class="o">/</span><span class="nx">pages</span><span class="o">/</span><span class="nx">index</span><span class="p">.</span><span class="nx">vue</span> <span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">v-layout</span> <span class="na">row</span> <span class="na">wrap</span> <span class="na">justify</span><span class="nt">-center</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">v-flex</span> <span class="na">xs8</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pb-1&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">new-todo-form</span> <span class="nt">@add</span><span class="s">=&#34;addTodo&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/v-flex&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">v-flex</span> <span class="nt">v-for</span><span class="s">=&#34;todo of todoList&#34; :key=&#34;todo.id&#34; xs8 class=&#34;my-1&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">todo-item</span> <span class="nt">:todo</span><span class="s">=&#34;todo&#34;</span> <span class="nt">@delete</span><span class="s">=&#34;deleteTodo&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/v-flex&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="err">/v-layout&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">NewTodoForm</span> <span class="nx">from</span> <span class="s1">&#39;../components/NewTodoForm&#39;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">TodoItem</span> <span class="nx">from</span> <span class="s1">&#39;../components/TodoItem&#39;</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span> <span class="nx">TodoItem</span><span class="p">,</span> <span class="nx">NewTodoForm</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">todoList</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;TODO 1&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">text</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;Lorem ipsum dolor sit amet, consectetur adipiscing elit&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">dueDate</span><span class="o">:</span> <span class="s1">&#39;2020-10-16&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">createdDate</span><span class="o">:</span> <span class="s1">&#39;2020-03-09&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">done</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">category</span><span class="o">:</span> <span class="s1">&#39;Работа&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">id</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;TODO 2&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">text</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;Lorem ipsum dolor sit amet, consectetur adipiscing elit&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">dueDate</span><span class="o">:</span> <span class="s1">&#39;2020-10-16&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">createdDate</span><span class="o">:</span> <span class="s1">&#39;2020-03-09&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">done</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">category</span><span class="o">:</span> <span class="s1">&#39;Работа&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">id</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;TODO 3&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">text</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;Lorem ipsum dolor sit amet, consectetur adipiscing elit&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">dueDate</span><span class="o">:</span> <span class="s1">&#39;2020-10-16&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">createdDate</span><span class="o">:</span> <span class="s1">&#39;2020-03-09&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">done</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">category</span><span class="o">:</span> <span class="s1">&#39;Работа&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">id</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;TODO 4&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">text</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;Lorem ipsum dolor sit amet, consectetur adipiscing elit&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">dueDate</span><span class="o">:</span> <span class="s1">&#39;2020-10-16&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">createdDate</span><span class="o">:</span> <span class="s1">&#39;2020-03-09&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">done</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">category</span><span class="o">:</span> <span class="s1">&#39;Работа&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">id</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;TODO 5&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">text</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;Lorem ipsum dolor sit amet, consectetur adipiscing elit&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">dueDate</span><span class="o">:</span> <span class="s1">&#39;2020-10-16&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">createdDate</span><span class="o">:</span> <span class="s1">&#39;2020-03-09&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">done</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">category</span><span class="o">:</span> <span class="s1">&#39;Работа&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">id</span><span class="o">:</span> <span class="mi">6</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">title</span><span class="o">:</span> <span class="s1">&#39;TODO 6&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">text</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">            <span class="s1">&#39;Lorem ipsum dolor sit amet, consectetur adipiscing elit&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">dueDate</span><span class="o">:</span> <span class="s1">&#39;2020-10-16&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">createdDate</span><span class="o">:</span> <span class="s1">&#39;2020-03-09&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">done</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">category</span><span class="o">:</span> <span class="s1">&#39;Работа&#39;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">addTodo</span><span class="p">(</span><span class="nx">newTodo</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">todoList</span><span class="p">.</span><span class="nx">length</span>
</span></span><span class="line"><span class="cl">        <span class="o">?</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="kc">null</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="k">this</span><span class="p">.</span><span class="nx">todoList</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">item</span> <span class="p">=&gt;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">id</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="o">:</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">todoList</span><span class="p">.</span><span class="nx">unshift</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">id</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">createdDate</span><span class="o">:</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">().</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="nx">done</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">...</span><span class="nx">newTodo</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">deleteTodo</span><span class="p">(</span><span class="nx">todoId</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">todoList</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">todoList</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">item</span> <span class="p">=&gt;</span> <span class="nx">item</span><span class="p">.</span><span class="nx">id</span> <span class="o">!==</span> <span class="nx">todoId</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span></code></pre></div>
    </section>
</details>

<p>После проделанной работы рекомендую проверить работоспособность получившегося макета. Запустите <code>dev</code> сервер и перейдите на http://localhost:3000/, там вы должны увидеть следующую картину:</p>
 

<details>
    <summary><strong>Функциональный макет</strong></summary>
    <section>
        <figure 
	
		class="gallery-image" 
		style="
			flex-grow: 151; 
			flex-basis: 363px"
	>
	<a href="/p/nuxt-django-graphql/gsg0plu-vg6tllgm1gvgfcot9oi.png" data-size="869x573">
		<img src="/p/nuxt-django-graphql/gsg0plu-vg6tllgm1gvgfcot9oi.png"
			width="869"
			height="573"
			srcset="/p/nuxt-django-graphql/gsg0plu-vg6tllgm1gvgfcot9oi_hue6396bee632e15b15340367c187bc3d3_54914_480x0_resize_box_3.png 480w, /p/nuxt-django-graphql/gsg0plu-vg6tllgm1gvgfcot9oi_hue6396bee632e15b15340367c187bc3d3_54914_1024x0_resize_box_3.png 1024w"
			loading="lazy"
			alt="Nuxt &#43; Vuetify">
	</a>
	
	<figcaption>Nuxt + Vuetify</figcaption>
	
</figure>
    </section>
</details>

<h2 id="объединение-фронтенда-и-бэкенда">Объединение фронтенда и бэкенда</h2>
<h3 id="настройка-csrf-защиты-django--apollo">Настройка CSRF-защиты Django + Apollo</h3>
<p>В Django по-умолчанию используется <a class="link" href="https://ru.wikipedia.org/wiki/%d0%9c%d0%b5%d0%b6%d1%81%d0%b0%d0%b9%d1%82%d0%be%d0%b2%d0%b0%d1%8f_%d0%bf%d0%be%d0%b4%d0%b4%d0%b5%d0%bb%d0%ba%d0%b0_%d0%b7%d0%b0%d0%bf%d1%80%d0%be%d1%81%d0%b0"  target="_blank" rel="noopener"
    >CSRF</a> защита.</p>
<p>Эта защита реализуется при помощи <a class="link" href="https://djbook.ru/rel1.7/topics/http/middleware.html"  target="_blank" rel="noopener"
    >промежуточного слоя</a> (middleware) — <code>CsrfViewMiddleware</code>. Посмотреть на него вы можете в файле <code>settings.py</code> в переменной <code>MIDDLEWARE</code>.</p>
<p>Принцип его работы очень прост: у любого POST-запроса к Django в  заголовках должен иметься CSRF-токен. Если этот токен отсутствует, то  сервер просто отклоняет этот запрос.</p>
<p>CSRF-токен в классическом django приложении приходит вместе с любым  GET-запросом, после чего при необходимости добавляется в формы при  рендеринге шаблона.</p>
<p>В нашем случае проблема в том, что вне зависимости от того,  выполняется в Apollo мутация или запрос, метод их по-умолчанию всегда  будет POST. Apollo позволяет изменить это поведение таким образом, чтобы для <code>Query</code> метод запроса был GET, а для <code>Mutation</code> — POST, но насколько я знаю, graphene на данный момент не поддерживает подобный режим работы.</p>
<p>Я поступил следующим образом: немного расширил логику стандартного <code>CsrfViewMiddleware</code> таким образом, чтобы он проверял тип GraphQL запроса, и уже на основе этого принимал или сбрасывал соединение.</p>
<p>Для этого добавим кастомную проверку CSRF, например, в уже знакомый нам файл <code>api.py</code></p>
 

<details>
    <summary><strong>api.py</strong></summary>
    <section>
        <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># backend/backend/api.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">graphene</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">django.middleware.csrf</span> <span class="kn">import</span> <span class="n">CsrfViewMiddleware</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">backend.todo_list.schema</span> <span class="kn">import</span> <span class="n">Query</span><span class="p">,</span> <span class="n">Mutation</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">schema</span> <span class="o">=</span> <span class="n">graphene</span><span class="o">.</span><span class="n">Schema</span><span class="p">(</span><span class="n">query</span><span class="o">=</span><span class="n">Query</span><span class="p">,</span> <span class="n">mutation</span><span class="o">=</span><span class="n">Mutation</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CustomCsrfMiddleware</span><span class="p">(</span><span class="n">CsrfViewMiddleware</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="nf">process_view</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">callback_args</span><span class="p">,</span> <span class="n">callback_kwargs</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;csrf_processing_done&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">callback</span><span class="p">,</span> <span class="s1">&#39;csrf_exempt&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="kc">None</span>
</span></span><span class="line"><span class="cl">        <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">body</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">body</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">body</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># в любой непонятной ситуации передаём запрос оригинальному CsrfViewMiddleware</span>
</span></span><span class="line"><span class="cl">        <span class="k">except</span> <span class="p">(</span><span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">UnicodeDecodeError</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">CustomCsrfMiddleware</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">process_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">callback_args</span><span class="p">,</span> <span class="n">callback_kwargs</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># проверка на list, т.к. клиент может отправлять &#34;батченные&#34; запросы</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># https://blog.apollographql.com/batching-client-graphql-queries-a685f5bcd41b</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">body</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">query</span> <span class="ow">in</span> <span class="n">body</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># если внутри есть хотя бы одна мутация, то отправляем запрос</span>
</span></span><span class="line"><span class="cl">                <span class="c1"># к оригинальному CsrfViewMiddleware</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="s1">&#39;mutation&#39;</span> <span class="ow">in</span> <span class="n">query</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="k">break</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_accept</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="c1"># принимаем любые query без проверки на csrf</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="s1">&#39;query&#39;</span> <span class="ow">in</span> <span class="n">body</span> <span class="ow">and</span> <span class="s1">&#39;mutation&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">body</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_accept</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span><span class="n">CustomCsrfMiddleware</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">process_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">callback</span><span class="p">,</span> <span class="n">callback_args</span><span class="p">,</span> <span class="n">callback_kwargs</span><span class="p">)</span>
</span></span></code></pre></div>
    </section>
</details>

<p>Далее, в файле <code>settings.py</code> нужно заменить &ldquo;оригинальный&rdquo; <code>CsrfViewMiddleware</code>, на кастомный:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># settings.py</span>
</span></span><span class="line"><span class="cl"><span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;backend.backend.api.CustomCsrfMiddleware&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># &#39;django.middleware.csrf.CsrfViewMiddleware&#39;,</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><p>Если уважаемый читатель знает более надежные и правильные способы  CSRF-защиты в связке Django + Nuxt + Apollo, то призываю поделиться  своим знанием в комментариях.</p>
<h3 id="django-cors-headers">Django CORS Headers</h3>
<p>Т.к. dev сервера бэкенда и фронтента у нас стоят на разных портах, то Django нужно оповестить, с каких хостов могут совершаться запросы, и  какие заголовки ему разрешено обрабатывать. А поможет нам в этом  библиотека <code>django-cors-headers</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">pipenv install <span class="s2">&#34;django-cors-headers&gt;=3.2&#34;</span>
</span></span></code></pre></div><p>В <code>settings.py</code> добавим:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="c1"># backend/backend/settings.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">corsheaders.defaults</span> <span class="kn">import</span> <span class="n">default_headers</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;graphene_django&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;backend.todo_list&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;corsheaders&#39;</span><span class="p">,</span>  <span class="c1"># вот эту строку</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">CORS_ALLOW_CREDENTIALS</span> <span class="o">=</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl"><span class="n">CORS_ALLOW_HEADERS</span> <span class="o">=</span> <span class="n">default_headers</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;cache-control&#39;</span><span class="p">,</span> <span class="s1">&#39;cookies&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">CORS_ORIGIN_ALLOW_ALL</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># не рекомендуется для production</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># А также парочку middleware</span>
</span></span><span class="line"><span class="cl"><span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;corsheaders.middleware.CorsMiddleware&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="o">...</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></div><h3 id="установка-и-настройка-apollo">Установка и настройка Apollo</h3>
<p>Для Nuxt существует собственный модуль <code>apollo</code>, который в свою очередь основан на библиотеке <code>vue-apollo</code> (которая в свою очередь основана на Apollo). Для его установки введите:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sh" data-lang="sh"><span class="line"><span class="cl">npm install --save @nuxtjs/apollo graphql-tag cookie-universal-nuxt
</span></span></code></pre></div><p>Также при конфигурации <code>Apollo</code> нам понадобится небольшая библиотека <code>cookie-universal-nuxt</code> для манипуляции куками при рендере на стороне сервера.
Добавим эти модули в <code>nuxt.config.js</code>. В зависимости от вашей изначальной конфигурации там уже может быть несоклько модулей. Как минимум там должен быть <code>vuetify</code>:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// nuxt.config.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="p">...,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">modules</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">...,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;@nuxtjs/vuetify&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;@nuxtjs/apollo&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;cookie-universal-nuxt&#39;</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">apollo</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">clientConfigs</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">default</span><span class="o">:</span> <span class="s1">&#39;~/plugins/apollo-client.js&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Настройка Apollo дело невсегда тривиальное. Постараемся обойтись  минимальной конфигурацией. Создадим файл по указанному выше пути:</p>
<p>Конфигурируем клиент <code>Apollo</code>, а вместе с тем формируем цепочку обработчиков запросов.</p>
 

<details>
    <summary><strong>apollo-client.js</strong></summary>
    <section>
        <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// frontend/plugins/apollo-client.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">HttpLink</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;apollo-link-http&#39;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">setContext</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;apollo-link-context&#39;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">from</span><span class="p">,</span> <span class="nx">concat</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;apollo-link&#39;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">InMemoryCache</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;apollo-cache-inmemory&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Если плагин является функцией, то в процессе инициализации Nuxt передаёт в неё контекст ctx
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">export</span> <span class="k">default</span> <span class="nx">ctx</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * По-умолчанию при рендере со стороны сервера заголовки
</span></span></span><span class="line"><span class="cl"><span class="cm">   * в запросе к бэкенду не отправляются, так что &#34;пробрасываем&#34;
</span></span></span><span class="line"><span class="cl"><span class="cm">   * заголовки от клиента.
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">ssrMiddleware</span> <span class="o">=</span> <span class="nx">setContext</span><span class="p">((</span><span class="nx">_</span><span class="p">,</span> <span class="p">{</span> <span class="nx">headers</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">client</span><span class="p">)</span> <span class="k">return</span> <span class="nx">headers</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="p">...</span><span class="nx">headers</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">connection</span><span class="o">:</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">connection</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">referer</span><span class="o">:</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">referer</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">cookie</span><span class="o">:</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">context</span><span class="p">.</span><span class="nx">req</span><span class="p">.</span><span class="nx">headers</span><span class="p">.</span><span class="nx">cookie</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">   * Добавление CSRF-токена к запросу.
</span></span></span><span class="line"><span class="cl"><span class="cm">   * https://docs.djangoproject.com/en/2.2/ref/csrf/#ajax
</span></span></span><span class="line"><span class="cl"><span class="cm">   */</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">csrfMiddleware</span> <span class="o">=</span> <span class="nx">setContext</span><span class="p">((</span><span class="nx">_</span><span class="p">,</span> <span class="p">{</span> <span class="nx">headers</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">headers</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="p">...</span><span class="nx">headers</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;X-CSRFToken&#39;</span><span class="o">:</span> <span class="nx">ctx</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">$cookies</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;csrftoken&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">httpLink</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HttpLink</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">uri</span><span class="o">:</span> <span class="s1">&#39;http://localhost:8000/graphql/&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">credentials</span><span class="o">:</span> <span class="s1">&#39;include&#39;</span>
</span></span><span class="line"><span class="cl">  <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Middleware в Apollo это примерно тоже самое что и middleware в Django, 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// только на стороне клиента. Объединяем их в цепочку. Последовательность важна.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">link</span> <span class="o">=</span> <span class="nx">from</span><span class="p">([</span><span class="nx">csrfMiddleware</span><span class="p">,</span> <span class="nx">ssrMiddleware</span><span class="p">,</span> <span class="nx">httpLink</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Инициализируем кэш. При должном усердии он может заменить Vuex,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// но об этом как-нибудь в другой раз
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">cache</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">InMemoryCache</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">link</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">cache</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// без отключения стандартного apollo-module HttpLink&#39;a в консоль сыпятся варнинги
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">defaultHttpLink</span><span class="o">:</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div>
    </section>
</details>

<p>На этом этапе лучше еще раз удостовериться, что Nuxt собирается без ошибок, запустив dev сервер.</p>
<h3 id="оживляем-приложение">Оживляем приложение</h3>
<p>И вот наконец настало время соединить фронт и бэк.</p>
<p>Для начала где-нибудь создадим файл, в котором будут храниться все  запросы и мутации к бэкенду. В моем случае этот файл расположился по  пути <code>frontend/graphql.js</code> с уже знакомым нам содержимым:</p>
 

<details>
    <summary><strong>graphql.js</strong></summary>
    <section>
        <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">gql</span> <span class="nx">from</span> <span class="s1">&#39;graphql-tag&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// т.к. внутренности записи Todo используются практически во всех запросах,
</span></span></span><span class="line"><span class="cl"><span class="c1">// то резонно вынести их в отдельный фрагмент
</span></span></span><span class="line"><span class="cl"><span class="c1">// https://www.apollographql.com/docs/react/data/fragments/
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">TODO_FRAGMENT</span> <span class="o">=</span> <span class="nx">gql</span><span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">  fragment TodoContents on TodoNode {
</span></span></span><span class="line"><span class="cl"><span class="sb">    id
</span></span></span><span class="line"><span class="cl"><span class="sb">    title
</span></span></span><span class="line"><span class="cl"><span class="sb">    text
</span></span></span><span class="line"><span class="cl"><span class="sb">    done
</span></span></span><span class="line"><span class="cl"><span class="sb">    createdDate
</span></span></span><span class="line"><span class="cl"><span class="sb">    dueDate
</span></span></span><span class="line"><span class="cl"><span class="sb">    category {
</span></span></span><span class="line"><span class="cl"><span class="sb">      id
</span></span></span><span class="line"><span class="cl"><span class="sb">      name
</span></span></span><span class="line"><span class="cl"><span class="sb">    }
</span></span></span><span class="line"><span class="cl"><span class="sb">  }
</span></span></span><span class="line"><span class="cl"><span class="sb">`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">ADD_TODO</span> <span class="o">=</span> <span class="nx">gql</span><span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">  mutation(
</span></span></span><span class="line"><span class="cl"><span class="sb">    $title: String!
</span></span></span><span class="line"><span class="cl"><span class="sb">    $text: String
</span></span></span><span class="line"><span class="cl"><span class="sb">    $dueDate: Date!
</span></span></span><span class="line"><span class="cl"><span class="sb">    $category: String!
</span></span></span><span class="line"><span class="cl"><span class="sb">  ) {
</span></span></span><span class="line"><span class="cl"><span class="sb">    addTodo(
</span></span></span><span class="line"><span class="cl"><span class="sb">      title: $title
</span></span></span><span class="line"><span class="cl"><span class="sb">      text: $text
</span></span></span><span class="line"><span class="cl"><span class="sb">      dueDate: $dueDate
</span></span></span><span class="line"><span class="cl"><span class="sb">      category: $category
</span></span></span><span class="line"><span class="cl"><span class="sb">    ) {
</span></span></span><span class="line"><span class="cl"><span class="sb">      ...TodoContents
</span></span></span><span class="line"><span class="cl"><span class="sb">    }
</span></span></span><span class="line"><span class="cl"><span class="sb">  }
</span></span></span><span class="line"><span class="cl"><span class="sb">  </span><span class="si">${</span><span class="nx">TODO_FRAGMENT</span><span class="si">}</span><span class="sb">
</span></span></span><span class="line"><span class="cl"><span class="sb">`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">TOGGLE_TODO</span> <span class="o">=</span> <span class="nx">gql</span><span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">  mutation($todoId: ID) {
</span></span></span><span class="line"><span class="cl"><span class="sb">    toggleTodo(todoId: $todoId) {
</span></span></span><span class="line"><span class="cl"><span class="sb">      ...TodoContents
</span></span></span><span class="line"><span class="cl"><span class="sb">    }
</span></span></span><span class="line"><span class="cl"><span class="sb">  }
</span></span></span><span class="line"><span class="cl"><span class="sb">  </span><span class="si">${</span><span class="nx">TODO_FRAGMENT</span><span class="si">}</span><span class="sb">
</span></span></span><span class="line"><span class="cl"><span class="sb">`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">GET_CATEGORIES</span> <span class="o">=</span> <span class="nx">gql</span><span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">  {
</span></span></span><span class="line"><span class="cl"><span class="sb">    categories {
</span></span></span><span class="line"><span class="cl"><span class="sb">      id
</span></span></span><span class="line"><span class="cl"><span class="sb">      name
</span></span></span><span class="line"><span class="cl"><span class="sb">    }
</span></span></span><span class="line"><span class="cl"><span class="sb">  }
</span></span></span><span class="line"><span class="cl"><span class="sb">`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">GET_TODO_LIST</span> <span class="o">=</span> <span class="nx">gql</span><span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">  {
</span></span></span><span class="line"><span class="cl"><span class="sb">    todoList {
</span></span></span><span class="line"><span class="cl"><span class="sb">      ...TodoContents
</span></span></span><span class="line"><span class="cl"><span class="sb">    }
</span></span></span><span class="line"><span class="cl"><span class="sb">  }
</span></span></span><span class="line"><span class="cl"><span class="sb">  </span><span class="si">${</span><span class="nx">TODO_FRAGMENT</span><span class="si">}</span><span class="sb">
</span></span></span><span class="line"><span class="cl"><span class="sb">`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">REMOVE_TODO</span> <span class="o">=</span> <span class="nx">gql</span><span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">  mutation($todoId: ID) {
</span></span></span><span class="line"><span class="cl"><span class="sb">    removeTodo(todoId: $todoId)
</span></span></span><span class="line"><span class="cl"><span class="sb">  }
</span></span></span><span class="line"><span class="cl"><span class="sb">`</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="p">{</span> <span class="nx">ADD_TODO</span><span class="p">,</span> <span class="nx">TOGGLE_TODO</span><span class="p">,</span> <span class="nx">GET_CATEGORIES</span><span class="p">,</span> <span class="nx">GET_TODO_LIST</span><span class="p">,</span> <span class="nx">REMOVE_TODO</span> <span class="p">}</span>
</span></span></code></pre></div>
    </section>
</details>

<p>Теперь нужно немного изменить уже существующий функционал фронтенда.  Наконец пришло время добавить туда взаимодействие с бэкендом.</p>
<p>Изменим Vue компоненты:</p>
 

<details>
    <summary><strong>index.vue</strong></summary>
    <section>
        <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="line"><span class="cl"><span class="c">&lt;!--</span> <span class="nx">frontend</span><span class="o">/</span><span class="nx">pages</span><span class="o">/</span><span class="nx">index</span><span class="p">.</span><span class="nx">vue</span> <span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">v-layout</span> <span class="na">row</span> <span class="na">wrap</span> <span class="na">justify</span><span class="nt">-center</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">v-flex</span> <span class="na">xs8</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pb-1&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="c">&lt;!--</span> <span class="nx">emit</span><span class="s1">&#39;ы теперь нам не нужны --&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">      &lt;new-todo-form /&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">    &lt;/v-flex&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">    &lt;v-flex v-for=&#34;todo of todoList&#34; :key=&#34;todo.id&#34; xs8 class=&#34;my-1&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">      &lt;todo-item :todo=&#34;todo&#34; /&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">    &lt;/v-flex&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">  &lt;/v-layout&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">&lt;/template&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">
</span></span></span><span class="line"><span class="cl"><span class="s1">&lt;script&gt;
</span></span></span><span class="line"><span class="cl"><span class="s1">import NewTodoForm from &#39;</span><span class="p">..</span><span class="o">/</span><span class="nx">components</span><span class="o">/</span><span class="nx">NewTodoForm</span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">import TodoItem from &#39;</span><span class="p">..</span><span class="o">/</span><span class="nx">components</span><span class="o">/</span><span class="nx">TodoItem</span><span class="s1">&#39;
</span></span></span><span class="line"><span class="cl"><span class="s1">// импортируем свеженаписанные запросы
</span></span></span><span class="line"><span class="cl"><span class="s1">import { GET_TODO_LIST } from &#39;</span><span class="p">..</span><span class="o">/</span><span class="nx">graphql</span><span class="err">&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">components</span><span class="o">:</span> <span class="p">{</span> <span class="nx">TodoItem</span><span class="p">,</span> <span class="nx">NewTodoForm</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">data</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">todoList</span><span class="o">:</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">apollo</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// получаем список todoList. При таком объявлении запроса переменная todoList
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// должна записаться результатами запроса, однако запрос должен называться
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// аналогично с переменной
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">todoList</span><span class="o">:</span> <span class="p">{</span> <span class="nx">query</span><span class="o">:</span> <span class="nx">GET_TODO_LIST</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span></code></pre></div>
    </section>
</details>

 

<details>
    <summary><strong>NewTodoForm.vue</strong></summary>
    <section>
        <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="line"><span class="cl"><span class="c">&lt;!--</span> <span class="nx">frontend</span><span class="o">/</span><span class="nx">components</span><span class="o">/</span><span class="nx">NewTodoForm</span><span class="p">.</span><span class="nx">vue</span> <span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">v-card</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">v-card-title</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pb-1&#34;</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;overflow-wrap: break-word;&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">b</span><span class="p">&gt;{{</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">title</span> <span class="p">}}&lt;/</span><span class="nt">b</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">v-spacer</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="c">&lt;!--</span> <span class="nx">Изменено</span> <span class="nx">событие</span> <span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">v-btn</span>
</span></span><span class="line"><span class="cl">        <span class="nt">@click</span><span class="s">=&#34;remove&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">flat</span>
</span></span><span class="line"><span class="cl">        <span class="na">small</span>
</span></span><span class="line"><span class="cl">        <span class="na">icon</span>
</span></span><span class="line"><span class="cl">        <span class="na">style</span><span class="o">=</span><span class="s">&#34;position: absolute; right: 0; top: 0&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">v-icon</span> <span class="nt">:disabled</span><span class="s">=&#34;$nuxt.isServer&#34;</span> <span class="na">small</span><span class="p">&gt;</span><span class="nx">close</span><span class="o">&lt;</span><span class="err">/v-icon&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="err">/v-btn&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/v-card-title&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">v-card-text</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;py-1&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">v-layout</span> <span class="na">row</span> <span class="na">justyfy</span><span class="nt">-center</span> <span class="na">align</span><span class="nt">-center</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">v-flex</span> <span class="na">xs11</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;overflow-wrap: break-word;&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="p">{{</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">text</span> <span class="p">}}</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="err">/v-flex&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">v-flex</span> <span class="na">xs1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;text-align: right;&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!--</span> <span class="nx">Добавлена</span> <span class="nx">обработка</span> <span class="nx">клика</span> <span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">v-checkbox</span>
</span></span><span class="line"><span class="cl">              <span class="nt">:value</span><span class="s">=&#34;todo.done&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="nt">@click.once</span><span class="s">=&#34;toggle&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="na">hide</span><span class="nt">-details</span>
</span></span><span class="line"><span class="cl">              <span class="na">class</span><span class="o">=</span><span class="s">&#34;pa-0 ma-0&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="na">style</span><span class="o">=</span><span class="s">&#34;display: inline-block;&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="na">color</span><span class="o">=</span><span class="s">&#34;green lighten-1&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="err">/v-flex&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="err">/v-layout&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/v-card-text&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">v-card-actions</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;grey--text&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Выполнить</span> <span class="nx">до</span> <span class="p">&lt;</span><span class="nt">v-icon</span> <span class="na">small</span><span class="p">&gt;</span><span class="nx">event</span><span class="o">&lt;</span><span class="err">/v-icon&gt; {{ todo.dueDate }} | Создано</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">v-icon</span> <span class="na">small</span><span class="p">&gt;</span><span class="nx">calendar_today</span><span class="o">&lt;</span><span class="err">/v-icon&gt; {{ todo.createdDate }}</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">v-spacer</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;grey--text&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!--</span> <span class="nx">Изменен</span> <span class="nx">путь</span> <span class="nx">получения</span> <span class="nx">имени</span> <span class="nx">категории</span> <span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">v-icon</span> <span class="na">small</span><span class="p">&gt;</span><span class="nx">category</span><span class="o">&lt;</span><span class="err">/v-icon&gt;Категория: {{ todo.category.name }}</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/v-card-actions&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="err">/v-card&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// импортируем свеженаписанные запросы
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">GET_TODO_LIST</span><span class="p">,</span> <span class="nx">REMOVE_TODO</span><span class="p">,</span> <span class="nx">TOGGLE_TODO</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../graphql&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;TodoItem&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">todo</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">type</span><span class="o">:</span> <span class="nb">Object</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="k">default</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">({})</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// с этого момента изменения по-серьезнее
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">toggle</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// Для запроса который возвращает измененный элемент не обязательно
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// вручную прописывать функцию update. Apollo сам найдёт в каких
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// запросах &#34;участвует&#34; измененная запись, и разошлет всем подписчикам
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// измененный объект. В нашем случае это запрос в компоненте index.vue
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// на получение списка Todo
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">this</span><span class="p">.</span><span class="nx">$apollo</span><span class="p">.</span><span class="nx">mutate</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">mutation</span><span class="o">:</span> <span class="nx">TOGGLE_TODO</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">variables</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">todoId</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">todo</span><span class="p">.</span><span class="nx">id</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">remove</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// функция update не видит контекста this
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kr">const</span> <span class="nx">todoId</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">todo</span><span class="p">.</span><span class="nx">id</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">$apollo</span><span class="p">.</span><span class="nx">mutate</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">mutation</span><span class="o">:</span> <span class="nx">REMOVE_TODO</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">variables</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">todoId</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nx">update</span><span class="p">(</span><span class="nx">store</span><span class="p">,</span> <span class="p">{</span> <span class="nx">data</span><span class="o">:</span> <span class="p">{</span> <span class="nx">removeTodo</span> <span class="p">}</span> <span class="p">})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">removeTodo</span><span class="p">)</span> <span class="k">return</span>
</span></span><span class="line"><span class="cl">          <span class="c1">// В случае успешного удаления удаляем текущий элемент из кэша
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">readQuery</span><span class="p">({</span> <span class="nx">query</span><span class="o">:</span> <span class="nx">GET_TODO_LIST</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">          <span class="nx">data</span><span class="p">.</span><span class="nx">todoList</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">todoList</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">todo</span> <span class="p">=&gt;</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">id</span> <span class="o">!==</span> <span class="nx">todoId</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="c1">// Самоуничтожаемся!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="nx">store</span><span class="p">.</span><span class="nx">writeQuery</span><span class="p">({</span> <span class="nx">query</span><span class="o">:</span> <span class="nx">GET_TODO_LIST</span><span class="p">,</span> <span class="nx">data</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span></code></pre></div>
    </section>
</details>

 

<details>
    <summary><strong>TodoItem.vue</strong></summary>
    <section>
        <div class="highlight"><pre tabindex="0" class="chroma"><code class="language-vue" data-lang="vue"><span class="line"><span class="cl"><span class="c">&lt;!--</span> <span class="nx">frontend</span><span class="o">/</span><span class="nx">components</span><span class="o">/</span><span class="nx">TodoItem</span><span class="p">.</span><span class="nx">vue</span> <span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">v-card</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">v-card-title</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;pb-1&#34;</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;overflow-wrap: break-word;&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">b</span><span class="p">&gt;{{</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">title</span> <span class="p">}}&lt;/</span><span class="nt">b</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">v-spacer</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="c">&lt;!--</span> <span class="nx">Изменено</span> <span class="nx">событие</span> <span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">v-btn</span>
</span></span><span class="line"><span class="cl">        <span class="nt">@click</span><span class="s">=&#34;remove&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="na">flat</span>
</span></span><span class="line"><span class="cl">        <span class="na">small</span>
</span></span><span class="line"><span class="cl">        <span class="na">icon</span>
</span></span><span class="line"><span class="cl">        <span class="na">style</span><span class="o">=</span><span class="s">&#34;position: absolute; right: 0; top: 0&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">v-icon</span> <span class="nt">:disabled</span><span class="s">=&#34;$nuxt.isServer&#34;</span> <span class="na">small</span><span class="p">&gt;</span><span class="nx">close</span><span class="o">&lt;</span><span class="err">/v-icon&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="err">/v-btn&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/v-card-title&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">v-card-text</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;py-1&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">v-layout</span> <span class="na">row</span> <span class="na">justyfy</span><span class="nt">-center</span> <span class="na">align</span><span class="nt">-center</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">v-flex</span> <span class="na">xs11</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;overflow-wrap: break-word;&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="p">{{</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">text</span> <span class="p">}}</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="err">/v-flex&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">v-flex</span> <span class="na">xs1</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="p">&lt;</span><span class="nt">div</span> <span class="na">style</span><span class="o">=</span><span class="s">&#34;text-align: right;&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="c">&lt;!--</span> <span class="nx">Добавлена</span> <span class="nx">обработка</span> <span class="nx">клика</span> <span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">&lt;</span><span class="nt">v-checkbox</span>
</span></span><span class="line"><span class="cl">              <span class="nt">:value</span><span class="s">=&#34;todo.done&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="nt">@click.once</span><span class="s">=&#34;toggle&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="na">hide</span><span class="nt">-details</span>
</span></span><span class="line"><span class="cl">              <span class="na">class</span><span class="o">=</span><span class="s">&#34;pa-0 ma-0&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="na">style</span><span class="o">=</span><span class="s">&#34;display: inline-block;&#34;</span>
</span></span><span class="line"><span class="cl">              <span class="na">color</span><span class="o">=</span><span class="s">&#34;green lighten-1&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="err">/v-flex&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="err">/v-layout&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/v-card-text&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">v-card-actions</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;grey--text&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">Выполнить</span> <span class="nx">до</span> <span class="p">&lt;</span><span class="nt">v-icon</span> <span class="na">small</span><span class="p">&gt;</span><span class="nx">event</span><span class="o">&lt;</span><span class="err">/v-icon&gt; {{ todo.dueDate }} | Создано</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">v-icon</span> <span class="na">small</span><span class="p">&gt;</span><span class="nx">calendar_today</span><span class="o">&lt;</span><span class="err">/v-icon&gt; {{ todo.createdDate }}</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">v-spacer</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;</span><span class="nt">span</span> <span class="na">class</span><span class="o">=</span><span class="s">&#34;grey--text&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="c">&lt;!--</span> <span class="nx">Изменен</span> <span class="nx">путь</span> <span class="nx">получения</span> <span class="nx">имени</span> <span class="nx">категории</span> <span class="o">--&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="p">&lt;</span><span class="nt">v-icon</span> <span class="na">small</span><span class="p">&gt;</span><span class="nx">category</span><span class="o">&lt;</span><span class="err">/v-icon&gt;Категория: {{ todo.category.name }}</span>
</span></span><span class="line"><span class="cl">      <span class="p">&lt;/</span><span class="nt">span</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/v-card-actions&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="err">/v-card&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">template</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// импортируем свеженаписанные запросы
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">GET_TODO_LIST</span><span class="p">,</span> <span class="nx">REMOVE_TODO</span><span class="p">,</span> <span class="nx">TOGGLE_TODO</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;../graphql&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;TodoItem&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">props</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">todo</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">type</span><span class="o">:</span> <span class="nb">Object</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="k">default</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">({})</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// с этого момента изменения по-серьезнее
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">methods</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">toggle</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// Для запроса который возвращает измененный элемент не обязательно
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// вручную прописывать функцию update. Apollo сам найдёт в каких
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// запросах &#34;участвует&#34; измененная запись, и разошлет всем подписчикам
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// измененный объект. В нашем случае это запрос в компоненте index.vue
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// на получение списка Todo
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">this</span><span class="p">.</span><span class="nx">$apollo</span><span class="p">.</span><span class="nx">mutate</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">mutation</span><span class="o">:</span> <span class="nx">TOGGLE_TODO</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">variables</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">todoId</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">todo</span><span class="p">.</span><span class="nx">id</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">remove</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// функция update не видит контекста this
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kr">const</span> <span class="nx">todoId</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">todo</span><span class="p">.</span><span class="nx">id</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">$apollo</span><span class="p">.</span><span class="nx">mutate</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">mutation</span><span class="o">:</span> <span class="nx">REMOVE_TODO</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">variables</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">todoId</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="nx">update</span><span class="p">(</span><span class="nx">store</span><span class="p">,</span> <span class="p">{</span> <span class="nx">data</span><span class="o">:</span> <span class="p">{</span> <span class="nx">removeTodo</span> <span class="p">}</span> <span class="p">})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">removeTodo</span><span class="p">)</span> <span class="k">return</span>
</span></span><span class="line"><span class="cl">          <span class="c1">// В случае успешного удаления удаляем текущий элемент из кэша
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">store</span><span class="p">.</span><span class="nx">readQuery</span><span class="p">({</span> <span class="nx">query</span><span class="o">:</span> <span class="nx">GET_TODO_LIST</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">          <span class="nx">data</span><span class="p">.</span><span class="nx">todoList</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">todoList</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">todo</span> <span class="p">=&gt;</span> <span class="nx">todo</span><span class="p">.</span><span class="nx">id</span> <span class="o">!==</span> <span class="nx">todoId</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="c1">// Самоуничтожаемся!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="nx">store</span><span class="p">.</span><span class="nx">writeQuery</span><span class="p">({</span> <span class="nx">query</span><span class="o">:</span> <span class="nx">GET_TODO_LIST</span><span class="p">,</span> <span class="nx">data</span> <span class="p">})</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span></code></pre></div>
    </section>
</details>

<p>Проверим, что у нас получилось</p>
 

<details>
    <summary><strong>Результат</strong></summary>
    <section>
        <figure 
	
		class="gallery-image" 
		style="
			flex-grow: 203; 
			flex-basis: 487px"
	>
	<a href="/p/nuxt-django-graphql/xy3e_-efabaavt-hjfy68fb_ftw.gif" data-size="918x452">
		<img src="/p/nuxt-django-graphql/xy3e_-efabaavt-hjfy68fb_ftw.gif"
			width="918"
			height="452"
			srcset="/p/nuxt-django-graphql/xy3e_-efabaavt-hjfy68fb_ftw_hu1054838543e688952e9935adee432a9a_235906_480x0_resize_box_1.gif 480w, /p/nuxt-django-graphql/xy3e_-efabaavt-hjfy68fb_ftw_hu1054838543e688952e9935adee432a9a_235906_1024x0_resize_box_1.gif 1024w"
			loading="lazy"
			>
	</a>
	
</figure>
    </section>
</details>

<h2 id="заключение">Заключение</h2>
<p>В этой статье я попытался рассказать как построить взаимодействие  между Django и Nuxt с помощью GraphQL API, показать решение проблем с  которыми довелось столкнуться мне. Надеюсь это подтолкнет энтузиастов  попробовать что-то новое, и сэкономит время в решении проблем.</p>
<p>Весь код доступен на <a class="link" href="https://github.com/IngvarListard/nuxt-django-graphql-example"  target="_blank" rel="noopener"
    >GitHub</a>.</p>

</section>


    <footer class="article-footer">
    

    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.css"integrity="sha384-RZU/ijkSsFbcmivfdRBQDtwuwVqK7GMOw6IMvKyeWL2K5UAlyp6WonmB8m7Jd0Hn"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/katex.min.js"integrity="sha384-pK1WpvzWVBQiP0/GjnvRxV4mOb0oxFuyRxJlk6vVw146n3egcN5C925NCP7a7BY8"crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.13.13/dist/contrib/auto-render.min.js"integrity="sha384-vZTG03m&#43;2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl"crossorigin="anonymous"
                defer="true"
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
        renderMathInElement(document.querySelector(`.article-content`), {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ]
        });})
</script>
    
</article>

    

    <aside class="related-contents--wrapper">
    
    
</aside>

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "https-ingvarlistard-github-io" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (DISQUS) {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2021 - 
        
        2023 Handy Code
    </section>
    
    <section class="powerby">
        Создано при помощи <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Тема <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.6.0">Stack</a></b>, дизайн <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer="true"
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    
        <aside class="sidebar right-sidebar sticky">
            <section class="widget archives">
                <div class="widget-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



                </div>
                <h2 class="widget-title section-title">Содержание</h2>
                
                <div class="widget--toc">
                    <nav id="TableOfContents">
  <ol>
    <li><a href="#предисловие">Предисловие</a></li>
    <li><a href="#о-чем-и-для-кого-эта-статья">О чем и для кого эта статья</a></li>
    <li><a href="#перед-началом">Перед началом</a></li>
    <li><a href="#django">Django</a>
      <ol>
        <li><a href="#создание-проекта-и-окружения">Создание проекта и окружения</a></li>
        <li><a href="#настройка">Настройка</a>
          <ol>
            <li><a href="#перенос-managepy">Перенос manage.py</a></li>
            <li><a href="#добавление-graphene_django">Добавление graphene_django</a></li>
            <li><a href="#проверяем-работоспособность">Проверяем работоспособность</a></li>
            <li><a href="#настройка-graphene">Настройка graphene</a></li>
          </ol>
        </li>
        <li><a href="#приложение-todo_list">Приложение todo_list</a>
          <ol>
            <li><a href="#создание-приложения">Создание приложения</a></li>
            <li><a href="#создание-graphql-api">Создание GraphQL API</a></li>
            <li><a href="#проверка-api">Проверка API</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#nuxt">Nuxt</a>
      <ol>
        <li><a href="#создание-nuxt-приложения">Создание Nuxt приложения</a></li>
        <li><a href="#перенос-конфигурационных-файлов">Перенос конфигурационных файлов</a></li>
        <li><a href="#верстка-функционального-макета">Верстка функционального макета</a></li>
      </ol>
    </li>
    <li><a href="#объединение-фронтенда-и-бэкенда">Объединение фронтенда и бэкенда</a>
      <ol>
        <li><a href="#настройка-csrf-защиты-django--apollo">Настройка CSRF-защиты Django + Apollo</a></li>
        <li><a href="#django-cors-headers">Django CORS Headers</a></li>
        <li><a href="#установка-и-настройка-apollo">Установка и настройка Apollo</a></li>
        <li><a href="#оживляем-приложение">Оживляем приложение</a></li>
      </ol>
    </li>
    <li><a href="#заключение">Заключение</a></li>
  </ol>
</nav>
                </div>
            </section>
        </aside>
    

        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                defer="false"
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
